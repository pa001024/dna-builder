# 妮弗尔夫人技能实现文档

## 角色基础信息
- **角色名称**: 妮弗尔夫人
- **属性**: 光属性
- **武器精通**: 太刀/手枪

## 技能机制

### 1. 日食 (E技能)

#### 技能描述
根据当前状态释放不同技能：
- **日食状态**: 对周围敌人造成光属性伤害，降低其攻击力
- **月猎状态**: 对远处敌人造成光属性伤害，降低其移动速度

#### 实现要点
- 类型：伤害技能 (INSTANT/AREA)
- 冷却时间：基础冷却
- 双状态切换机制
- 日食状态：
  - 伤害半径：3米
  - 攻击降低：25%
  - 攻击降低持续时间：3秒
- 月猎状态：
  - 伤害半径：10米
  - 移动速度降低：30%
  - 移动速度降低持续时间：3秒
- 神智消耗：12（受效益属性影响）
- 所有伤害倍率从LeveledSkill获取

---

### 2. 雾海安魂 (Q技能)

#### 技能描述
消耗大量神智进入[送葬]状态，大幅提升技能范围和伤害效果。

#### 实现要点
- 类型：增益技能 (BUFF)
- 神智消耗：120（受效益属性影响）
- [送葬]状态效果：
  - 持续时间：12秒（受耐久属性影响）
  - 技能范围转化比例：100%
  - 强化日食伤害半径：6米
  - 强化月猎伤害半径：10米
  - 伤害倍率大幅提升
- 触发概率提高：60%
- 需要实现状态管理系统
- 所有数值从LeveledSkill获取

---

### 3. 啼鸣交织 (被动技能)

#### 技能描述
战斗中有概率触发特殊效果，概率随等级提升。

#### 实现要点
- 类型：被动技能 (PASSIVE)
- 触发概率：14%-58%（随等级提升）
- 概率上限：50%
- 需要监听战斗事件
- 概率计算基于技能等级
- 实现随机触发机制

---

## 根源能力

根据buff.data.ts中的数据，妮弗尔夫人有以下根源能力：

| 名称 | 效果 |
|------|------|
| 赛琪被动 | 基础被动效果 |
| 赛琪1塑 | 第一塑像效果 |
| 赛琪6塑 | [破茧]状态中自身全属性穿透提高50.0% |

---

## 数据获取方式

### LeveledSkill数据结构
- 技能等级：从LeveledSkill获取
- 伤害倍率：从LeveledSkill获取
- 神智消耗：从LeveledSkill获取
- 状态持续时间：从LeveledSkill获取
- 范围数值：从LeveledSkill获取

### CharBuild.calculateAttributes
- 基础属性：攻击263.6、生命1318、护盾1318、防御255、神智180
- 威力：0（基础值）
- 范围：0.3
- 效益：影响神智消耗

---

## AI实现建议

### 核心系统
1. **双状态系统**: 需要实现日食/月猎状态切换机制
2. **送葬状态**: 需要实现持续状态管理，包括范围和伤害提升
3. **概率触发系统**: 需要实现被动技能的概率计算和触发机制

### 技能实现优先级
1. **日食**: 基础伤害技能，需要实现双状态切换
2. **雾海安魂**: 增益技能，需要实现送葬状态管理
3. **啼鸣交织**: 被动技能，需要实现概率触发系统

### 数值平衡建议
- 所有数值从LeveledSkill和CharBuild.calculateAttributes动态获取
- 实现技能等级系统，使技能效果随等级提升
- 平衡双状态的伤害和效果差异
- 考虑送葬状态的持续时间和消耗平衡

---

## 特殊机制

### 状态切换逻辑
```typescript
// 状态切换示例
private switchDayNightMode(state: GameState): void {
    const playerState = state.player as any
    playerState.isDayMode = !playerState.isDayMode
}

// 技能效果根据状态变化
private calculateSkillDamage(): number {
    const leveledSkill = this.getLeveledSkill()
    const isDayMode = (state.player as any).isDayMode
    
    const damageField = leveledSkill.字段.find(field => 
        field.名称.includes(isDayMode ? "[日食]" : "[月猎]")
    )
    
    return (damageField?.值 || 0) / 100
}
```

### 范围转化机制
```typescript
// 送葬状态范围转化
private calculateEnhancedRange(baseRange: number): number {
    const playerState = state.player as any
    if (!playerState.inFuneralState) return baseRange
    
    const conversionRate = this.getFieldValue("技能范围转化比例")
    return baseRange * (1 + conversionRate)
}
```